# 🤖 Telegram Instagram Downloader Bot - نسخه پیشرفته

ربات قدرتمند تلگرام برای دانلود ویدیو و عکس از اینستاگرام با چندین روش دانلود و پنل مدیریت کامل

## ✨ امکانات پیشرفته

### 🎯 دانلود
- 🎬 دانلود ویدیو، عکس، ریل و IGTV از اینستاگرام
- 🔄 چندین روش دانلود برای اطمینان از موفقیت
- 📱 پشتیبانی از تمام فرمت‌های اینستاگرام
- ⚡ سرعت بالا و کیفیت عالی

### 👤 پنل کاربری
- 📊 آمار دقیق و کامل شخصی
- 🔄 مشاهده آخرین دانلودها
- ⏳ نمایش محدودیت‌های روزانه
- 📅 تاریخ عضویت و فعالیت

### 🔧 پنل ادمین (دسترسی با `/panel`)
- 📈 آمار کلی سیستم
- 👥 مدیریت کاربران (15 کاربر برتر)
- 📊 گزارش تفصیلی دانلودها
- 🗑️ مدیریت لاگ‌ها
- 🕐 ساعات پرترافیک و آمار هفتگی

### 🛡️ امنیت و کنترل
- 🚫 سیستم محدودیت روزانه دانلود
- 👤 سیستم مدیریت و بن کاربران
- 📝 سیستم لاگ پیشرفته
- 🔐 حفاظت از SQL Injection

## 📁 فایل‌های پروژه

- `config.php` - تنظیمات ربات (توکن، دیتابیس، تنظیمات)
- `bot.php` - فایل اصلی ربات با تمام عملکردها
- `setup.sql` - اسکریپت نصب دیتابیس
- `README.md` - راهنمای کامل نصب و استفاده

## ⚙️ نصب و راه‌اندازی

### 1. پیش‌نیازها

- PHP 7.4 یا بالاتر
- MySQL/MariaDB
- cURL extension
- PDO MySQL extension

### 2. ایجاد ربات در تلگرام

1. به [@BotFather](https://t.me/BotFather) پیام دهید
2. دستور `/newbot` را ارسال کنید
3. نام و نام کاربری ربات را انتخاب کنید
4. توکن ربات را کپی کنید

### 3. تنظیم فایل config.php

```php
define('BOT_TOKEN', 'YOUR_BOT_TOKEN_HERE'); // توکن ربات خود را اینجا قرار دهید
define('ADMIN_ID', 123456789); // آیدی تلگرام خود را اینجا قرار دهید
```

### 4. تنظیم پایگاه داده

```php
define('DB_HOST', 'localhost');
define('DB_NAME', 'telegram_bot'); // نام پایگاه داده
define('DB_USER', 'root');        // نام کاربری پایگاه داده
define('DB_PASS', '');            // رمز عبور پایگاه داده
```

### 5. راه‌اندازی پایگاه داده

**روش آسان:** فایل `setup.sql` را در phpMyAdmin اجرا کنید

یا دستی:
```sql
CREATE DATABASE a1156450_solitack CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 6. آپلود فایل‌ها

تمام فایل‌ها را روی سرور خود آپلود کنید:
- `config.php` (با تنظیمات شما)
- `bot.php` (فایل اصلی ربات)
- `setup.sql` (برای نصب دیتابیس)

### 7. تنظیم Webhook

```bash
curl -F "url=https://yourdomain.com/bot.php" https://api.telegram.org/bot7624862714:AAEB93kWba5pzpoWrOa7O_7aOOxDHAKq6ug/setWebhook
```

### 8. تست ربات

1. ربات را در تلگرام پیدا کنید
2. دستور `/start` را ارسال کنید
3. لینک اینستاگرام تست کنید
4. ادمین با `/panel` وارد پنل مدیریت شوید

## 🎯 نحوه استفاده

### کاربران عادی:
- `/start` - شروع ربات
- ارسال لینک اینستاگرام برای دانلود
- استفاده از منوی کلیدبورد برای دسترسی به امکانات

### مدیر:
- `/panel` - دسترسی به پنل مدیریت
- مشاهده آمار کلی
- مدیریت کاربران
- کنترل دانلودها

## 📊 ساختار پایگاه داده

### جدول users
- `id` - آیدی کاربر تلگرام
- `username` - نام کاربری
- `first_name` - نام
- `last_name` - نام خانوادگی
- `downloads_today` - تعداد دانلود امروز
- `total_downloads` - کل دانلودها
- `is_banned` - وضعیت بن
- `join_date` - تاریخ عضویت
- `last_activity` - آخرین فعالیت

### جدول downloads
- `id` - شناسه دانلود
- `user_id` - آیدی کاربر
- `url` - لینک دانلود شده
- `file_type` - نوع فایل
- `file_size` - حجم فایل
- `download_date` - تاریخ دانلود

### جدول settings
- `setting_key` - کلید تنظیم
- `setting_value` - مقدار تنظیم

## 🔧 تنظیمات قابل تغییر

```php
define('MAX_DOWNLOADS_PER_DAY', 50);     // حداکثر دانلود روزانه
define('MAX_FILE_SIZE', 50 * 1024 * 1024); // حداکثر حجم فایل (50MB)
```

## 🛡️ امنیت

- تمام ورودی‌ها اعتبارسنجی می‌شوند
- استفاده از Prepared Statements برای جلوگیری از SQL Injection
- محدودیت دانلود روزانه
- سیستم بن کاربران

## 🚀 ویژگی‌های فنی پیشرفته

### 🔄 سیستم دانلود چندگانه
- **روش اول**: Instagram API با پارامترهای خاص
- **روش دوم**: Scraping پیشرفته با Regex
- **روش سوم**: آماده برای ادغام API های شخص ثالث
- **Fallback**: اگر یک روش کار نکرد، روش بعدی امتحان می‌شود

### 📊 سیستم آمارگیری
- آمار کاربران (کل، فعال امروز، فعال هفته، عضو جدید)
- آمار دانلودها (کل، امروز، هفته، توزیع نوع فایل)
- ساعات پرترافیک و روندهای استفاده
- گزارش‌های تفصیلی برای ادمین

### 🛡️ امنیت
- محافظت از SQL Injection با Prepared Statements
- اعتبارسنجی ورودی‌ها
- سیستم لاگ پیشرفته با جزئیات
- مدیریت خطا و Exception handling

### ⚡ بهینه‌سازی
- Cache کردن اتصال دیتابیس
- Reset خودکار محدودیت‌های روزانه
- Index های بهینه برای جستجوی سریع
- Memory management بهبود یافته

## 🔧 تنظیمات پیشرفته

### محدودیت‌ها (در config.php)
```php
define('MAX_DOWNLOADS_PER_DAY', 50);     // حداکثر دانلود روزانه
define('MAX_FILE_SIZE', 50 * 1024 * 1024); // حداکثر حجم فایل (50MB)
```

### لاگ‌ها
- تمام فعالیت‌ها در فایل `bot_log.txt` ذخیره می‌شود
- ادمین می‌تواند لاگ‌ها را پاک کند
- جزئیات خطاها و موفقیت‌ها

## 📞 عیب‌یابی

### مشکلات رایج:
1. **ربات جواب نمی‌دهد**:
   - webhook را چک کنید
   - لاگ‌های سرور را بررسی کنید
   - تست کنید: `curl https://api.telegram.org/bot7624862714:AAEB93kWba5pzpoWrOa7O_7aOOxDHAKq6ug/getMe`

2. **دانلود کار نمی‌کند**:
   - فایل `bot_log.txt` را چک کنید
   - مطمئن شوید لینک اینستاگرام عمومی است
   - چند روش مختلف دانلود در کد وجود دارد

3. **پنل ادمین کار نمی‌کند**:
   - `ADMIN_ID` در config.php را چک کنید
   - مطمئن شوید آیدی عددی درست است

### فایل‌های مهم:
- `bot_log.txt` - لاگ‌های دقیق عملکرد
- `config.php` - تنظیمات اصلی
- Error logs سرور

## 🔄 بروزرسانی

برای بروزرسانی:
1. فایل‌های جدید را آپلود کنید
2. اگر ساختار دیتابیس تغییر کرده، `setup.sql` را اجرا کنید
3. cache ربات را clear کنید

## 📱 تماس و پشتیبانی

- **آیدی ادمین**: `7388512919`
- **توکن ربات**: `7624862714:AAEB93kWba5pzpoWrOa7O_7aOOxDHAKq6ug`
- **دیتابیس**: `a1156450_solitack`

---

## ✅ چک‌لیست نصب

- [ ] توکن ربات از BotFather گرفته شد
- [ ] فایل config.php با اطلاعات صحیح تنظیم شد  
- [ ] دیتابیس ایجاد شد (setup.sql اجرا شد)
- [ ] فایل‌ها روی سرور آپلود شدند
- [ ] webhook تنظیم شد
- [ ] ربات با /start تست شد
- [ ] دانلود تست شد
- [ ] پنل ادمین با /panel تست شد

🎉 **ربات آماده است! از دانلود با کیفیت بالا لذت ببرید!**
